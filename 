
"use client"
import toast from 'react-hot-toast';

import Editor from '@monaco-editor/react';
import React, { useState } from "react";

export default function Homepage() {
  const [code, setCode] = useState("// Start coding here...");
  const [selectedLanguage, setSelectedLanguage] = useState("cpp");

  const handleRunCode = async() => {
    try {
     const response = await fetch(`/api/user/executecode`,{
        method : "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({code, selectedLanguage})
      })
       const result = await response.json();
      if(result.status == 200){
        console.log("Code executed successfully");
        toast.success("Code Execution successfull");
      }else{
        console.log("error executing code");

        toast.error("Code Execution successfull");
      }
    } catch (error) {
     console.log("Could not run code ", error);
      toast.error("error submitting code");
    }
  };

  const handleLanguageChange = (e) => {
    setSelectedLanguage(e.target.value);
    setCode("// Start coding here..."); // Reset code when language changes if needed
  };

  return (
    <div>
      {/* Problem Description Section */}
      <div className="w-full h-36 border-2 border-white">
        <p>This is where the problem description will be pasted.</p>
      </div>

      {/* Main Editor and Output Section */}
      <div className="flex flex-row">
        {/* Editor Section */}
        <div className="w-1/2 bg-slate-400 h-full border-2 border-white">
          {/* Language Dropdown */}
          <div className="flex justify-end p-2">
            
        <button onClick={handleRunCode} className="border-2 mx-2 border-black text-black  p-3 rounded-lg">Run Code</button>
            <select
              value={selectedLanguage}
              onChange={handleLanguageChange}
              className="border-2 border-white p-2 rounded-lg"
            >
              <option value="cpp">C++</option>
              <option value="javascript">JavaScript</option>
              <option value="python">Python</option>
              <option value="c">C</option>
              <option value="java">Java</option>
              <option value="rust">Rust</option>
             </select>
          </div>

          {/* Monaco Editor */}
          <Editor
            value={code}
            onChange={(value, e) => setCode(value)}
            theme='vs-dark'
            height="70vh"
            width="100%"
            language={selectedLanguage}
            defaultValue={`// Start by including necessary headers for ${selectedLanguage}`}
          />
        </div>

        {/* Output Section */}
        <div className="border-2 border-white w-1/2">
          <p className="text-center m-20">Will display code output here.</p>
        </div>
      </div>
    </div>
  );
}

